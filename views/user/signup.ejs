<%- include("../partials/navbar") %>

<div class="justify-center items-center h-screen flex">
    <div class="rounded-lg shadow-lg w-80 border-2 p-8">
        <p class="text-center text-gray-700 mb-4">Signup</p>
        <form id="signupForm" class="space-y-4">
            <input id="firstName" type="text" placeholder="First Name" class="border-gray-300 rounded w-full px-4 py-2 bg-gray-200" required/>
            <input id="lastName" type="text" placeholder="Last Name" class="border-gray-300 rounded w-full px-4 py-2 bg-gray-200" required/>
            <input id="email" type="email" placeholder="Email" class="border-gray-300 rounded w-full px-4 py-2 bg-gray-200" required/>
            <input id="password" type="password" placeholder="Password" class="border-gray-300 rounded w-full px-4 py-2 bg-gray-200" required/>
            <input id="confirmPassword" type="password" placeholder="Confirm Password" class="border-gray-300 rounded w-full px-4 py-2 bg-gray-200" required/>
            <button type="button" id="signupButton" class="rounded w-full py-2 mt-2 bg-black text-white">Signup</button>
        </form>
        <p class="text-center text-gray-700 mt-4">Or continue with</p>
        <div class="justify-center mt-2 flex">
            <img alt="Google logo" src="https://placehold.co/20x20"/>
        </div>
    </div>
</div> 

<%- include("../partials/footer") %>

<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
    document.getElementById('signupButton').addEventListener('click', async function() {
        const firstName = document.getElementById('firstName').value.trim();
        const lastName = document.getElementById('lastName').value.trim();
        const email = document.getElementById('email').value.trim();
        const password = document.getElementById('password').value.trim();
        const confirmPassword = document.getElementById('confirmPassword').value.trim();

        if (firstName === '' || lastName === '' || email === '' || password === '' || confirmPassword === '') {
            Swal.fire({
                icon: 'error',
                title: 'Oops...',
                text: 'All fields are required!',
            });
        }
        if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)){
            Swal.fire({
                icon: 'error',
                title: 'Oops...',
                text: 'Invalid email address!',
            });
        }
        if(!(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/).test(password)){
            Swal.fire({
                icon: 'error',
                title: 'Oops...',
                text: 'Password must be at least 8 characters long and contain at least one uppercase letter, one lowercase letter, one number, and one special character!',
            });
        }
        if (password !== confirmPassword) {
            Swal.fire({
                icon: 'error',
                title: 'Oops...',
                text: 'Passwords do not match!',
            });
            return;
        }
        if(firstName.length < 2 || lastName.length < 3){
            Swal.fire({
                icon: 'error',
                title: 'Oops...',
                text: 'First name and last name must be at least 3 characters long!',
            });
        }
        try {
            const response = await axios.post('/register', { firstName, lastName, email, password });
            if (response.data.success) {
                window.location.href = '/otpPage';
            }
        } catch (error) {
            Swal.fire({
                icon: 'error',
                title: 'Oops...',
                text: error.response.data.message || 'An error occurred during signup',
            });
        }
    });
</script>